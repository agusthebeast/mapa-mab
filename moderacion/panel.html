<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Moderaci√≥n de Im√°genes (Privado)</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 2rem; }
    h2 { color: #333; }
    #login { background: white; padding: 1.5rem; max-width: 300px; margin: auto; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    #panel.oculto { display: none; }
    #contenedor { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; margin-top: 2rem; }
    .imagen { background: white; border: 1px solid #ccc; border-radius: 10px; width: 200px; overflow: hidden; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .imagen img { width: 100%; display: block; }
    .imagen-info { padding: 10px; text-align: center; }
    .botones { display: flex; justify-content: space-around; padding: 10px; }
    .botones button {
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .aceptar { background-color: #4CAF50; color: white; }
    .rechazar { background-color: #f44336; color: white; }
  </style>
</head>
<body>

<div id="login">
  <h2>üîí Acceso privado</h2>
  <p>Ingres√° la contrase√±a para moderar im√°genes:</p>
  <input type="password" id="clave" placeholder="Contrase√±a..." style="width:100%;padding:0.5rem;margin-bottom:1rem;" />
  <button onclick="verificar()" style="width:100%;padding:0.5rem;">Ingresar</button>
</div>

<div id="panel" class="oculto">
  <h2>üñºÔ∏è Moderaci√≥n de Im√°genes Pendientes</h2>
  <div id="contenedor"></div>
</div>

<script>
  console.log("Panel cargado");
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwHrkn6TQUCjORBG3GXErYeNFqz6gfhdaFAYkBICI4w7STIcwq58M7OQ4_QbqJemMs_/exec'; // ‚Üê Peg√° tu URL del Apps Script
let claveIngresada = "";

function verificar() {
  const clave = document.getElementById("clave").value;
  claveIngresada = clave;
  cargarImagenes();
}

async function cargarImagenes() {
  const res = await fetch(`${SCRIPT_URL}?func=listarPendientes&clave=${encodeURIComponent(claveIngresada)}`);
  const tipo = res.headers.get("Content-Type");

  if (tipo && tipo.includes("application/json")) {
    const imagenes = await res.json();
    mostrarImagenes(imagenes);
    document.getElementById("login").style.display = "none";
    document.getElementById("panel").classList.remove("oculto");
  } else {
    alert("‚ùå Contrase√±a incorrecta.");
  }
}

function mostrarImagenes(imagenes) {
  const contenedor = document.getElementById('contenedor');
  contenedor.innerHTML = '';

  if (imagenes.length === 0) {
    contenedor.innerHTML = '<p>No hay im√°genes pendientes.</p>';
    return;
  }

  imagenes.forEach(img => {
    const div = document.createElement('div');
    div.className = 'imagen';
    div.innerHTML = `
      <img src="${img.url}" alt="Imagen">
      <div class="imagen-info">
        <p><strong>${img.distrito}</strong></p>
        <p>${img.categoria}</p>
      </div>
      <div class="botones">
        <button class="aceptar" onclick="moderarImagen('${img.public_id}', 'aceptar')">‚úÖ</button>
        <button class="rechazar" onclick="moderarImagen('${img.public_id}', 'rechazar')">‚ùå</button>
      </div>
    `;
    contenedor.appendChild(div);
  });
}

async function moderarImagen(publicId, accion) {
  const confirmar = confirm(`¬øQuer√©s ${accion === 'aceptar' ? 'aceptar' : 'rechazar'} esta imagen?`);
  if (!confirmar) return;

  const res = await fetch(`${SCRIPT_URL}?func=${accion}Imagen&public_id=${encodeURIComponent(publicId)}&clave=${encodeURIComponent(claveIngresada)}`);
  const texto = await res.text();

  if (texto === "OK") {
    alert(`‚úÖ Imagen ${accion}da correctamente.`);
    cargarImagenes();
  } else {
    alert("‚ùå Acceso denegado o error.");
  }
}
</script>

</body>
</html>
